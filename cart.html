<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Bag | BNK Wellness</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="container header-container">
            <div class="logo"><a href="index.html">BNK WELLNESS</a></div>
            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="index.html#products">Continue Shopping</a>
            </nav>
            <div class="header-icons">
                <div class="cart-icon">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count" id="cart-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <h1 style="margin: 2rem 0; text-align: center;">Your Shopping Bag</h1>
        
        <div class="cart-layout">
            <!-- Cart Items Section -->
            <div class="cart-items-container">
                <div id="cart-list">
                    <!-- Cart items injected here -->
                </div>
            </div>

            <!-- Address / Checkout Section -->
            <div class="order-summary">
                <h2>Order Summary</h2>
                
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span id="cart-subtotal">₹0</span>
                </div>
                <div class="summary-row">
                    <span>Shipping</span>
                    <span style="color: var(--success);">Free</span>
                </div>
                <div class="summary-row total-row">
                    <span>Total</span>
                    <span id="cart-total">₹0</span>
                </div>

                <form id="address-form" onsubmit="handleCheckout(event)" style="margin-top: 2rem;">
                    <h3 style="font-size: 1.2rem; margin-bottom: 1rem;">Shipping Details</h3>
                    
                    <div style="display: grid; gap: 15px;">
                        <input type="text" id="addr-name" required placeholder="Full Name" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 4px; width: 100%;">
                        <input type="tel" required placeholder="Phone Number" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 4px; width: 100%;">
                        <input type="text" id="addr-line1" required placeholder="Address Line 1" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 4px; width: 100%;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <input type="text" id="addr-city" required placeholder="City" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 4px; width: 100%;">
                            <input type="text" id="addr-zip" required placeholder="Pincode" style="padding: 12px; border: 1px solid #e2e8f0; border-radius: 4px; width: 100%;">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; font-size: 1.1rem;">
                        Proceed to Checkout
                    </button>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px; text-align: center;">
                        Secure Payment • 100% Authentic
                    </p>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3>BNK WELLNESS</h3>
                    <p style="color: #94a3b8; max-width: 300px;">
                        Elevating your daily ritual with science-backed Ayurvedic solutions. Pure, potent, and premium.
                    </p>
                </div>
                <div class="footer-col">
                    <h3>Shop</h3>
                    <ul>
                        <li>Sexual Wellness</li>
                        <li>Hair Care</li>
                        <li>Diabetic Care</li>
                        <li>All Products</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Support</h3>
                    <ul>
                        <li>Track Order</li>
                        <li>Shipping Policy</li>
                        <li>Returns</li>
                        <li>Contact Us</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Stay Connected</h3>
                    <div style="display: flex; gap: 15px; font-size: 1.2rem;">
                        <i class="fab fa-instagram"></i>
                        <i class="fab fa-facebook"></i>
                        <i class="fab fa-twitter"></i>
                    </div>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 BNK Wellness. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="js/products.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            renderCartPage();
        });

        function renderCartPage() {
            const cart = JSON.parse(localStorage.getItem('bnk_cart')) || [];
            const listContainer = document.getElementById('cart-list');
            const totalEl = document.getElementById('cart-total');
            const subtotalEl = document.getElementById('cart-subtotal');
            
            if(cart.length === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 4rem;">
                        <i class="fas fa-shopping-basket" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                        <p>Your bag is currently empty.</p>
                        <a href="index.html" class="btn btn-outline" style="margin-top: 1rem;">Start Shopping</a>
                    </div>
                `;
                totalEl.innerText = '₹0';
                subtotalEl.innerText = '₹0';
                return;
            }

            let total = 0;
            listContainer.innerHTML = cart.map((item, index) => {
                const product = products.find(p => p.id === item.productId);
                if(!product) return '';
                const itemTotal = product.price * item.qty;
                total += itemTotal;

                return `
                    <div class="cart-item">
                        <img src="${product.image}" alt="${product.name}">
                        <div class="cart-info">
                            <h4 style="margin-bottom: 0.2rem;">${product.name}</h4>
                            <div style="color: var(--text-muted); font-size: 0.9rem;">₹${product.price} each</div>
                        </div>
                        <div class="cart-actions">
                            <button onclick="updateCartQty(${index}, -1)" class="btn btn-outline" style="padding: 5px 10px;">-</button>
                            <span style="font-weight: 600;">${item.qty}</span>
                            <button onclick="updateCartQty(${index}, 1)" class="btn btn-outline" style="padding: 5px 10px;">+</button>
                        </div>
                        <div style="font-weight: 700;">₹${itemTotal}</div>
                    </div>
                `;
            }).join('');
            
            totalEl.innerText = '₹' + total;
            subtotalEl.innerText = '₹' + total;
        }

        function updateCartQty(index, change) {
            let cart = JSON.parse(localStorage.getItem('bnk_cart')) || [];
            if(cart[index]) {
                cart[index].qty += change;
                if(cart[index].qty <= 0) {
                    cart.splice(index, 1);
                }
            }
            localStorage.setItem('bnk_cart', JSON.stringify(cart));
            renderCartPage();
            updateCartCount(); // from main.js
        }

        function handleCheckout(e) {
            e.preventDefault();
            const cart = JSON.parse(localStorage.getItem('bnk_cart')) || [];
            if(cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            // Calculate total
            let total = 0;
            cart.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if(product) total += product.price * item.qty;
            });

            // Capture Order Data
            const orderData = {
                orderId: 'BNK-' + Math.floor(Math.random() * 100000),
                date: new Date().toLocaleDateString(),
                total: total,
                customer: {
                    name: document.getElementById('addr-name').value,
                    address: document.getElementById('addr-line1').value,
                    city: document.getElementById('addr-city').value,
                    pincode: document.getElementById('addr-zip').value
                },
                items: cart
            };

            // Save order to LocalStorage (simulating backend)
            localStorage.setItem('bnk_last_order', JSON.stringify(orderData));
            
            // Clear Cart
            localStorage.removeItem('bnk_cart');
            
            // Redirect to Confirmation
            window.location.href = 'confirmation.html';
        }
    </script>
</body>
</html>
