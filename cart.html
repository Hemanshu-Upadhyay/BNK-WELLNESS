<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Bag | BNK Wellness</title>
    <link rel="stylesheet" href="css/style.css?v=3">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </div>

            <div class="logo"><a href="index.html">BNK WELLNESS</a></div>
            
            <nav class="nav-links" id="nav-links">
                <a href="index.html">Home</a>
                <a href="index.html#products">Continue Shopping</a>
            </nav>
            
            <div class="header-icons">
                <div class="search-icon" onclick="openSearch()">
                    <i class="fas fa-search"></i>
                </div>
                <div class="cart-icon" onclick="window.location.href='cart.html'">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count" id="cart-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Search Modal -->
    <div class="search-overlay" id="search-overlay" onclick="closeSearchOnOverlay(event)">
        <div class="search-modal">
            <div class="search-modal-header">
                <h3>Search Products</h3>
                <button class="search-close-btn" onclick="closeSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-input-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" id="search-input" placeholder="Search for products..." oninput="handleSearch(this.value)">
            </div>
            <div class="search-results" id="search-results">
                <div class="search-no-results">Start typing to search...</div>
            </div>
        </div>
    </div>

    <main class="container" style="padding-top: 2rem;">
        <h1 style="margin: 2rem 0 2rem; text-align: center; font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 500;">Your Shopping Bag</h1>
        
        <div class="cart-layout">
            <!-- Cart Items Section -->
            <div class="cart-items-container">
                <div id="cart-list">
                    <!-- Cart items injected here -->
                </div>
            </div>

            <!-- Order Summary Section -->
            <div class="order-summary">
                <h2>Order Summary</h2>
                
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span id="cart-subtotal">₹0</span>
                </div>
                <div class="summary-row">
                    <span>Shipping</span>
                    <span style="color: var(--success);">Free</span>
                </div>
                <div class="total-row">
                    <span>Total</span>
                    <span id="cart-total">₹0</span>
                </div>

                <form id="address-form" onsubmit="handleCheckout(event)" style="margin-top: 2rem;">
                    <h3 style="font-size: 0.85rem; margin-bottom: 1rem; font-family: 'Lato', sans-serif; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 500;">Shipping Details</h3>
                    
                    <div style="display: grid; gap: 12px;">
                        <input type="text" id="addr-name" required placeholder="Full Name" class="form-input">
                        <input type="tel" required placeholder="Phone Number" class="form-input">
                        <input type="text" id="addr-line1" required placeholder="Address Line 1" class="form-input">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <input type="text" id="addr-city" required placeholder="City" class="form-input">
                            <input type="text" id="addr-zip" required placeholder="Pincode" class="form-input">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; padding: 16px;">
                        PROCEED TO CHECKOUT
                    </button>
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 12px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 6px;">
                        <i class="fas fa-lock"></i> Secure Payment • 100% Authentic
                    </p>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3 style="font-family: 'Playfair Display', serif; font-style: italic;">BNK WELLNESS</h3>
                    <p style="color: #9ca3af; max-width: 300px;">
                        Elevating your daily ritual with science-backed Ayurvedic solutions. Pure, potent, and premium.
                    </p>
                </div>
                <div class="footer-col">
                    <h3>Shop</h3>
                    <ul>
                        <li>Herbs</li>
                        <li>Oils</li>
                        <li>Butters</li>
                        <li>Consultations</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Support</h3>
                    <ul>
                        <li>Track Order</li>
                        <li>Shipping Policy</li>
                        <li>Returns</li>
                        <li>Contact Us</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Follow Us</h3>
                    <div style="display: flex; gap: 20px; font-size: 1.2rem; margin-top: 10px;">
                        <i class="fab fa-instagram" style="cursor: pointer;"></i>
                        <i class="fab fa-facebook" style="cursor: pointer;"></i>
                        <i class="fab fa-pinterest" style="cursor: pointer;"></i>
                    </div>
                </div>
            </div>
            <div class="copyright">
                &copy; 2025 BNK Wellness. All rights reserved.
            </div>
        </div>
    </footer>

    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span>Added to Cart!</span>
    </div>

    <script src="js/products.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Search Functions
        function openSearch() {
            document.getElementById('search-overlay').classList.add('active');
            document.getElementById('search-input').focus();
            document.body.style.overflow = 'hidden';
        }
        
        function closeSearch() {
            document.getElementById('search-overlay').classList.remove('active');
            document.getElementById('search-input').value = '';
            document.getElementById('search-results').innerHTML = '<div class="search-no-results">Start typing to search...</div>';
            document.body.style.overflow = '';
        }
        
        function closeSearchOnOverlay(e) {
            if (e.target.id === 'search-overlay') {
                closeSearch();
            }
        }
        
        function handleSearch(query) {
            const resultsContainer = document.getElementById('search-results');
            
            if (query.length < 2) {
                resultsContainer.innerHTML = '<div class="search-no-results">Start typing to search...</div>';
                return;
            }
            
            const filteredProducts = products.filter(p => 
                p.name.toLowerCase().includes(query.toLowerCase()) ||
                p.description.toLowerCase().includes(query.toLowerCase()) ||
                p.category.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredProducts.length === 0) {
                resultsContainer.innerHTML = '<div class="search-no-results">No products found for "' + query + '"</div>';
                return;
            }
            
            resultsContainer.innerHTML = filteredProducts.map(p => `
                <div class="search-result-item" onclick="window.location.href='product-detail.html?id=${p.id}'">
                    <img src="${p.image}" alt="${p.name}">
                    <div class="search-result-info">
                        <h4>${p.name}</h4>
                        <p>₹${p.price}</p>
                    </div>
                </div>
            `).join('');
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSearch();
            }
        });

        // Cart Logic
        document.addEventListener('DOMContentLoaded', () => {
            renderCartPage();
        });

        function renderCartPage() {
            const cart = JSON.parse(localStorage.getItem('bnk_cart')) || [];
            const listContainer = document.getElementById('cart-list');
            const totalEl = document.getElementById('cart-total');
            const subtotalEl = document.getElementById('cart-subtotal');
            
            if(cart.length === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem;">
                        <i class="fas fa-shopping-basket" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1.5rem; display: block;"></i>
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem; color: var(--text-muted);">Your bag is currently empty.</p>
                        <a href="index.html" class="btn btn-outline">Start Shopping</a>
                    </div>
                `;
                totalEl.innerText = '₹0';
                subtotalEl.innerText = '₹0';
                return;
            }

            let total = 0;
            listContainer.innerHTML = cart.map((item, index) => {
                const product = products.find(p => p.id === item.productId);
                if(!product) return '';
                const itemTotal = product.price * item.qty;
                total += itemTotal;

                return `
                    <div class="cart-item">
                        <img src="${product.image}" alt="${product.name}">
                        <div class="cart-info">
                            <h4>${product.name}</h4>
                            <div style="color: var(--text-muted); font-size: 0.9rem;">₹${product.price}</div>
                            <div class="qty-btn-group">
                                <button type="button" onclick="updateCartQty(${index}, -1)" class="qty-btn">
                                    <i class="fas fa-minus" style="font-size: 0.7rem;"></i>
                                </button>
                                <div class="qty-value">${item.qty}</div>
                                <button type="button" onclick="updateCartQty(${index}, 1)" class="qty-btn">
                                    <i class="fas fa-plus" style="font-size: 0.7rem;"></i>
                                </button>
                            </div>
                        </div>
                        <div class="cart-price">₹${itemTotal}</div>
                    </div>
                `;
            }).join('');
            
            totalEl.innerText = '₹' + total;
            subtotalEl.innerText = '₹' + total;
        }

        function updateCartQty(index, change) {
            let cart = JSON.parse(localStorage.getItem('bnk_cart')) || [];
            if(cart[index]) {
                cart[index].qty += change;
                if(cart[index].qty <= 0) {
                    cart.splice(index, 1);
                }
            }
            localStorage.setItem('bnk_cart', JSON.stringify(cart));
            renderCartPage();
            updateCartCount();
        }

        function handleCheckout(e) {
            e.preventDefault();
            const cart = JSON.parse(localStorage.getItem('bnk_cart')) || [];
            if(cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            let total = 0;
            cart.forEach(item => {
                const product = products.find(p => p.id === item.productId);
                if(product) total += product.price * item.qty;
            });

            const orderData = {
                orderId: 'BNK-' + Math.floor(Math.random() * 100000),
                date: new Date().toLocaleDateString(),
                total: total,
                customer: {
                    name: document.getElementById('addr-name').value,
                    address: document.getElementById('addr-line1').value,
                    city: document.getElementById('addr-city').value,
                    pincode: document.getElementById('addr-zip').value
                },
                items: cart
            };

            localStorage.setItem('bnk_last_order', JSON.stringify(orderData));
            localStorage.removeItem('bnk_cart');
            window.location.href = 'confirmation.html';
        }
    </script>
</body>
</html>
